# DDD 소개

프로그래머의 업무는 소프트웨어로 문제를 해결하는 것으로, 코딩은 소프트웨어 개발의 한 측면입니다. 좋은 디자인(설계)와 의사소통은 코딩 못지않게 중요합니다.  
소프트웨어 개발을 요구사항이라는 입력을 받아서 최종 결과를 출력하는 프로세스로 생각해본다면, "쓰레기를 넣으면 쓰레기가 나온다"는 법칙이 적용됩니다.  
불분명한 요구사항이나 잘못된 디자인과 같은 옳지 않은 입력으로는 어떤 코드도 원하는 결과를 생성해내지 못합니다.  
**명확한 커뮤니케이션과 도메인 지식 공유를 위한 디자인 방법론인 도메인 주도 설계로 어떻게 '쓰레기를 넣는' 부분을 최소화할지 알아보겠습니다.**

## 공유 모델의 중요성

<img width="430" height="368" alt="Image" src="https://github.com/user-attachments/assets/b0974e6e-c2fc-4679-8634-b96ab1b32ce7" />

문제를 풀기에 앞서 문제를 바르게 이해하는 것이 중요합니다. 여기서 말하는 이해는 당연히 도메인 전문가가 아니라 제품에 반영되는 개발자의 이해를 가리킵니다.  
개발자와 도메인 전문가가 서로 다르게 문제를 이해하면 프로젝트를 성공적으로 수행하기가 매우 어려워집니다.  
위 그림처럼 한 사람을 거칠때마다 메시지는 갈수록 왜곡되어 우스운 결과를 낳기때문에, 개발 도중에 중간 산물로 도메인 전문가에게 지속적인 피드백을 받는 것이 애자일 개발 프로세스의 핵심입니다.  
하지만 이 방식마저도 문제가 있습니다. 개발자는 번역가가 되어 번역 과정에서 중요하면서도 미묘한 사항들을 왜곡하고 누락할 수 있습니다.  

**만약 도메인 전문가, 개발팀, 다른 관계자들, 그리고 제일 중요한 소스 코드까지 모두 같은 모델을 공유한다면 어떨까요 ?**  
이 경우엔 도메인 전문가의 요구를 코드로 번역하는 과정이 필요없고, 모두가 공유하는 인식 모델을 그대로 반영하여 코드를 디자인합니다.  
이처럼 비즈니스 도메인과 소프트웨어를 일치시키면 여러 이점이 있습니다.

- 더 빠른 개발: 도메인 전문가와 개발자가 문제 인식을 공유하여 코드베이스에 반영하면, 그 팀은 적합한 솔루션을 빠르게 개발할 수 있습니다.
- 더 높은 비즈니스 가치: 문제에 정확하게 부합하는 솔루션은 고객의 만족도가 높고, 잘못된 길로 빠져들 가능성도 적습니다.
- 더 적은 낭비: 요구사항을 분명히 할수록 잘못 이해하여 다시 작성하는 시간 낭비가 줄어듭니다.
- 더 쉬운 유지 보수: 코드 속 모델이 도메인 전문가의 인식 모델과 일치하면 코드를 쉽게 수정할 수 있고 오류 발생 요소도 줄어듭니다.

이렇듯 모두가 공유하는 인식 모델을 구축하는 것이 중요합니다.  
도메인 주도 커뮤니티는 다음과 같이 몇몇 도움되는 지침들을 개발해왔습니다.

- 자료구조보다 비즈니스 이벤트와 작업 흐름에 집중하라.
- 문제 도메인을 더 작은 하위 도메인들로 나누어라.
- 솔루션에 각 하위 도메인별 모델을 만들어라.
- '공용어'라 부르는 공통 언어를 개발하여 프로젝트 참여자 모두가 공유하고 코드 모든 곳에서 활용하라.

## 비즈니스 이벤트로 도메인 이해하기

비즈니스에서 데이터는 그냥 머무르는 것이 아니라 어떤 식으로든 변환이 이루어집니다. 즉, 비즈니스 프로세스를 데이터와 문서 변환의 연속으로 생각할 수 있습니다.  
비즈니스 가치는 변환 과정에서 창출되므로, 어떻게 변환해 나아가고 각 과정이 서로 어떻게 연관되어 있는지 이해하는 것이 매우 중요합니다.

무엇이 데이터 변환을 촉발했든지, 이를 디자인에 포함시키는 것이 중요합니다. 이러한 작업을 **도메인 이벤트**라고 부릅니다.  
이는 우리가 모델링하려는 거의 모든 비즈니스 프로세스의 시작점입니다. (예를 들어 '새 주문서 받음'은 도메인 이벤트로서 주문 접수 프로세스를 촉발할 것입니다.)  
도메인 이벤트는 수정 불가한 이미 일어난 일이므로, 항상 무슨 일이 발생함 같은 과거형으로 씁니다.

### 이벤트 스토밍으로 도메인 탐색하기

**이벤트 스토밍**이란 비즈니스 이벤트와 이벤트가 수반하는 작업 흐름을 찾기 위해 모두가 협력하는 과정입니다.  
개발자와 도메인 전문가뿐만 아니라 프로젝트 성공에 관심이 있는 모든 이해관계자가 참석해야 합니다.  
사람들은 비즈니스 이벤트를 포스트잇에 써서 벽에 붙이고, 다른 누군가는 이벤트로 일어난 비즈니스 작업 흐름을 요약한 노트를 붙일 것입니다.  
이 방식은 참석한 모든 이들이 자신이 아는 것과 모르는 부분에 대한 질문을 끄집어내는 장점이 있습니다.

### 도메인 탐색하기: 주문 접수 시스템

<img width="601" height="361" alt="Image" src="https://github.com/user-attachments/assets/1d87b58e-8fb4-4e86-9261-e45dcf1707c7" />

이벤트들을 시간순으로 배치해보면 어느 팀의 출력이 다른 어느 팀의 입력이 되는지 명확하게 보입니다.  
예를 들어 주문접수팀이 주문 처리를 마치면 새로운 주문을 접수했음을 알려야 합니다. 이 '주문 접수함' 이벤트는 배송팀과 청구팀의 입력이 됩니다.

### 명령 문서화하기

고객이 우리가 주문서를 받기를 바라거나, 상사가 당신이 무언가를 수행하기를 바랄 수 있습니다.  
이런 요청을 DDD 용어로는 명령(command)라고 합니다. 명령은 항상 '이 일을 해달라' 같은 명령형으로 작성합니다.  
물론 모든 명령이 성공하는 것은 아닙니다. 우편 배달 도중 주문서가 분실될 수도 있고, 더 중요한 일로 상사를 도울 여력이 없을 수도 있습니다.  
명령에 성공하면 작업 흐름을 시작하여 또다시 그에 따른 도메인 이벤트를 생성합니다.

<img width="638" height="219" alt="Image" src="https://github.com/user-attachments/assets/683bf8df-7791-4388-b12f-fd82c5bc2cc1" />

## 도메인을 하위 도메인들로 나누기

커다란 문제를 마주하면 자연스레 각개격파 가능한 작은 요소들로 나누듯이 여기서도 마찬가지입니다.  
우리에게 커다란 문제란 **주문 접수를 둘러싼 이벤트들을 엮어내는 것입니다.**  
'주문 접수 프로세스'는 주문 접수, 배송, 청구 등의 다양한 측면으로 충분히 나눌 수 있습니다.  
비즈니스는 이미 이런 영역에 맞게 팀을 구분해뒀으며, 이것은 솔루션 디자인에서도 동일한 방식으로 구분할 수 있다는 강력한 힌트입니다.  
**이러한 방식으로 세분화한 각 영역들을 도메인이라고 부릅니다.**

<img width="413" height="205" alt="Image" src="https://github.com/user-attachments/assets/d479c8d3-3b4a-4ada-ab38-b5652c1daff2" />

도메인들은 서로 약간씩 겹치기 마련입니다.  
주문 접수 담당자는 청구팀과 배송팀이 어떻게 작동하는지 조금은 알아야 하고, 배송 담당자는 주문접수팀과 청구팀이 어떻게 작동하는지 약간이나마 알아야 합니다.

## 경계 진 맥락을 활용한 솔루션 만들기

문제를 이해한다고 해서 솔루션을 만드는 것이 쉬운 것은 아닙니다. 현실의 도메인이 지닌 모든 정보를 솔루션에 녹여내는 것은 불가능합니다.  
**특정 문제를 푸는데 관련한 정보만 솔루션에 담아내야 합니다.** 따라서 '문제 공간'과 '솔루션 공간'을 구분 지을 필요가 있으며, 이 둘을 서로 다른 것으로 인식해야 합니다.

<img width="687" height="250" alt="Image" src="https://github.com/user-attachments/assets/83799ef9-cced-44df-a96a-f011d373e187" />

문제 공간에서 도메인과 하위 도메인은 솔루션 공간에서 DDD 용어로 **경계 진 맥락**이라 부르는 솔루션 하부 시스템에 대응합니다.  
각 경계 진 맥락은 자체적으로 작은 도메인 모델입니다.

> 각 맥락은 솔루션 내에서 어떤 특화된 지식을 나타냅니다.  
> 맥락 안에서는 언어가 통용되고 디자인이 동일하지만, 맥락이 없는 정보는 현실 세계에서도 그렇듯이 의미가 불분명하여 쓸모가 없습니다.

> 현실 세상에서 도메인은 경계가 모호하지만, 소프트웨어 세상에서는 각 하부 시스템들이 서로 독립적으로 나아갈 수 있도록 상호 간의 유착을 낮추게끔 유도합니다.  
> 하부 시스템 간에 명시적인 API를 만들거나 공유 코드 등의 의존을 줄이는 식으로 상호 의존을 줄일 수 있습니다.  
> 이 말은 아쉽게도 우리의 도메인 모델을 절대로 실세계의 모든 사항을 담지 못한다는 의미입니다.

문제 공간의 도메인과 솔루션 공간의 맥락이 늘 일대일 관계는 아닙니다. 이러저러한 이유로 단일 도메인이 여러 경계진 맥락으로 나뉘기도 합니다.  
또한 문제 공간의 여러 도메인을 솔루션 공간에서 하나의 경계 진 맥락으로 모델링하는 경우도 많습니다.

<img width="622" height="219" alt="Image" src="https://github.com/user-attachments/assets/20de725c-8a63-4a8b-8b4d-895cc81b51d4" />

도메인을 어떻게 분할하든 간에 각각의 경계 진 맥락에는 명확한 책임이 있어야 합니다.  
왜냐하면 모델을 구현할때 경계 진 맥락은 특정 소트으웨어 구성 요소와 정확하게 대응해야 하기 때문입니다.

### 맥락 바로잡기

경계 진 맥락을 정의하는 것은 쉬워보이지만 실제로는 까다로운 작업입니다.  
아래는 도움이 될만한 몇 가지 지침입니다.

- 도메인 전문가의 말에 귀 기울이기: 그들이 모두 같은 언어를 사용하고 같은 문제에 집중한다면, 아마 같은 하위 도메인에서 일할 것입니다. 이는 단일 경계 진 맥락에 해당합니다.
- 기존 팀 및 팀의 경계에 주의하기: 이러한 경계들은 기업이 무엇을 도메인으로, 혹은 하위 도메인으로 여기는지 보여주는 중요한 단서입니다. 물론 이 경계가 늘 옳은 것은 아닙니다.
- 경계 진 맥락이 '경계 진'이란 말을 명심하기: 경계를 설정할때 슬금슬금 경계가 늘어나는 것을 조심해야 합니다. 요구사항이 변하는 복잡한 프로젝트에서 경계 진 맥락의 '경계'를 지키는 것에서 단호해야 합니다.
- 자율성을 염두에 둔 디자인: 두 그룹이 경계 진 맥락에 기여한다면, 결국에는 서로 다른 방향으로 디자인을 발전시켜나갈 수도 있습니다. 모든 사람을 만족시키는 하나의 거대한 맥락보다는 독립적으로 발전할 수 있는 개별적이고 자율적인 여러 경계 진 맥락들을 구성하는 것이 훨씬 바람직합니다.
- 막힘없는 비즈니스 작업 흐름 디자인하기: 작업 흐름이 여러 경계 진 맥락들과 상호작용 하느라 흐름이 막히거나 지연된다면, 디자인이 조금 못생겨지더라도 작업 흐름이 원활해지도록 맥락들을 리팩토링하는 것을 고려해봅니다.

### 맥락 지도 만들기

지금까지 경계 진 맥락들을 정의해왔다면, 이제 세부 사항이 드러나지 않은 큰 그림으로 맥락들 간의 상호작용을 드러내는 방식이 필요합니다.  
맥락 지도는 다양한 경계 진 맥락들과 그들의 관계를 추상화하여 보여줍니다. 모든 세부 사항을 녹여내는 것이 목표가 아니라 시스템 전체를 한눈에 볼 수 있게 하는 것입니다.

<img width="355" height="288" alt="Image" src="https://github.com/user-attachments/assets/a907c5c4-771d-42b7-84d5-d0ee3334f752" />

### 가장 중요한 맥락에 집중하기

**분명 다른 도메인보다 더 중요한 특정 도메인이 존재합니다.**  
이러한 도메인을 가리켜 핵심 도메인이라 하는데, 비즈니스 강점을 제공하며 수익을 창출해냅니다. 

## 공용어 만들기

우리가 디자인한 무언가는 도메인 전문가가 인식하는 실세계의 무언가를 나타내야 합니다.  
즉, 도메인 전문가가 무언가를 '주문'이라고 한다면, 코드에는 이에 해당하는 'Order'라는 요소가 있어야 하고, 같은 방식으로 동작해야 합니다.  
반대로 도메인 전문가의 모델에 없는 것을 디자인에 포함해서는 안됩니다. 따라서 'OrderFactory', 'OrderManager', 'OrderHelper'와 같은 용어는 디자인 단계에서는 사용하지 말아야 합니다.

공용어 제작은 도메인 전문가가 일방적으로 지시하는 단방향 프로세스가 아닌, 팀 전체의 협업입니다.  
또한 공용어 제작을 일회성으로 취급하지 않고 늘 수행하는 작업으로 인식해야 합니다.  
**마지막으로 모든 도메인과 맥락들을 포괄하는 단일 공용어는 있을 수 없음을 받아들여야 합니다.**  
예를 들어 객체지향 프로그래밍 도메인에서는 '클래스'는 어떤 무언가란 의미를 갖지만, CSS 도메인에서는 완전히 다른 것을 뜻합니다.






